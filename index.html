<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Blue Builder Helper ‚Äî Backyard Blueprint</title>

<style>
  :root{
    --bg:#081028;
    --grid:#0d2e5f;
    --grid2:#0b2142;
    --line:#67e8f9;
    --accent:#3b82f6;
    --accent2:#60a5fa;
    --text:#e9f2ff;
    --muted:#b8c8ff;
  }

  *{ box-sizing:border-box; }

  html,body{ height:100%; }

  body{
    margin:0;
    font:16px/1.4 Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial;
    background:var(--bg);
    color:var(--text);
    overflow:hidden;
  }

  /* MAIN APP */
  .app{
    position:relative;
    width:100%;
    height:100%;
  }

  /* BACKGROUND PHOTO */
  .photo-underlay{
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    object-fit:cover;
    opacity:.14;
    filter:saturate(0) contrast(1.1) brightness(.9);
    pointer-events:none;
  }

  /* ORB */
  .orb{
    --size:180px;
    position:absolute;
    left:50%;
    top:58%;
    transform:translate(-50%,-50%);
    width:var(--size);
    height:var(--size);
    border-radius:50%;
    background:
      radial-gradient(65% 65% at 35% 30%, #ffffffaa, transparent 45%),
      radial-gradient(100% 100% at 50% 50%, var(--accent2), var(--accent));
    box-shadow:
      0 10px 40px #3b82f666,
      inset 0 0 120px #60a5fa44;
    display:flex;
    align-items:center;
    justify-content:center;
    animation:bounce 2s ease-in-out infinite;
    z-index:10;
  }

  .orb.dock{
    animation:none;
    transition:transform .9s ease, top .9s ease, left .9s ease, width .6s ease, height .6s ease;
    top:70px;
    left:50%;
    transform:translate(-50%,0);
    width:120px;
    height:120px;
  }

  @keyframes bounce{
    0%,100%{ transform:translate(-50%,-50%) }
    50%{ transform:translate(-50%,-60%) }
  }

  .eye{
    width:38px;
    height:38px;
    background:#fff;
    border-radius:50%;
    position:absolute;
    overflow:hidden;
  }
  .eye .pupil{
    width:18px;
    height:18px;
    background:#000;
    border-radius:50%;
    position:absolute;
    top:10px;
    left:10px;
    transition:transform .05s linear;
  }

  .eyeL{ left:44px; top:56px; }
  .eyeR{ right:44px; top:56px; }

  .mouth{
    position:absolute;
    bottom:42px;
    left:50%;
    transform:translateX(-50%);
    width:56px;
    height:18px;
    border-radius:0 0 40px 40px / 0 0 18px 18px;
    background:#001a4d66;
    border:2px solid #001a4d99;
    border-top:none;
  }

  /* GREETING TEXT */
  .greet{
    position:absolute;
    top:calc(58% + 130px);
    left:50%;
    transform:translateX(-50%);
    font-size:24px;
    text-align:center;
    opacity:0;
    transition:opacity .8s;
    z-index:9;
  }

  .greet.show{ opacity:1; }

  /* MAIN CONTROLS */
  .controls{
    position:absolute;
    top:calc(58% + 200px);
    left:50%;
    transform:translateX(-50%);
    display:flex;
    gap:12px;
    flex-wrap:wrap;
    justify-content:center;
    z-index:9;
  }

  .btn{
    appearance:none;
    cursor:pointer;
    border:1px solid #2a4ea0;
    background:#0d1a3a;
    padding:10px 14px;
    border-radius:10px;
    color:#e5eeff;
    font-weight:600;
  }

  .btn.primary{
    background:linear-gradient(180deg,#1d4ed8,#1e40af);
    border-color:#1e3a8a;
  }

  /* SETTINGS PANEL */
  .panel{
    position:absolute;
    top:14px;
    right:14px;
    width:360px;
    max-width:94vw;
    background:#0b1533cc;
    border:1px solid #1e2a4c;
    border-radius:12px;
    padding:12px;
    backdrop-filter:blur(7px);
    z-index:12;
    display:none;
  }

  .panel h3{
    margin:0 0 10px 0;
    font-size:17px;
  }

  .row{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin-bottom:6px;
  }

  label{ font-size:14px; color:var(--muted); }

  input,select{
    width:100%;
    padding:8px 10px;
    border-radius:10px;
    border:1px solid #223a6b;
    background:#0b1430;
    color:var(--text);
  }

  .check{
    display:flex;
    align-items:center;
    gap:8px;
    color:#d7e4ff;
    font-size:14px;
  }

  .small{
    font-size:12px;
    color:#a9bdff;
  }

  /* BLUEPRINT */
  .blueprint{
    position:absolute;
    inset:0;
    display:none;
    z-index:4;
    background:
      linear-gradient(90deg,var(--grid2) 1px, transparent 1px) / 40px 40px repeat,
      linear-gradient(0deg,var(--grid2) 1px, transparent 1px) / 40px 40px repeat,
      linear-gradient(90deg,var(--grid) 1px, transparent 1px) / 200px 200px repeat,
      linear-gradient(0deg,var(--grid) 1px, transparent 1px) / 200px 200px repeat,
      linear-gradient(180deg,#071331,#091a3d);
  }

  svg{
    width:100%;
    height:100%;
  }

  /* TOOLBAR */
  .toolbar{
    position:absolute;
    top:14px;
    left:14px;
    display:none;
    gap:8px;
    z-index:12;
  }

  /* FALL ANIM */
  .fall{
    opacity:0;
    transform:translateY(-160px);
    animation:fallIn .7s forwards;
  }
  @keyframes fallIn{
    to{ opacity:1; transform:translateY(0); }
  }

  /* 3D FEATURE STYLING (combined A + B) */
  g.floating3D{
    cursor:grab;
    transition:transform .2s ease, filter .2s ease;
    transform-origin:center center;
    filter:drop-shadow(0px 14px 18px rgba(0,0,0,0.55));
  }
  g.floating3D:active{
    cursor:grabbing;
  }

</style>
</head>

<body>

<div class="app" id="app">

  <img id="photo" class="photo-underlay" alt="">

  <!-- ORB -->
  <div id="orb" class="orb">
    <div class="eye eyeL"><div class="pupil"></div></div>
    <div class="eye eyeR"><div class="pupil"></div></div>
    <div class="mouth"></div>
  </div>

  <!-- GREETING -->
  <div id="greet" class="greet">
    Hi! I‚Äôm your builder helper.<br>
    Upload your backyard and I‚Äôll sketch a plan.
  </div>

  <!-- MAIN CONTROLS -->
  <div class="controls" id="controls">
    <label class="btn">
      <input id="file" type="file" accept="image/*" hidden>
      üîå Upload Backyard Photo
    </label>
    <button id="openPanel" class="btn">More Options</button>
    <button id="quick" class="btn primary">Generate Blueprint</button>
  </div>

  <!-- SETTINGS PANEL -->
  <div id="panel" class="panel">
    <h3>Backyard Settings</h3>

    <div class="row">
      <div style="flex:1">
        <label>Length (ft)</label>
        <input id="lenFt" type="number" value="40" min="10" max="200">
      </div>

      <div style="flex:1">
        <label>Width (ft)</label>
        <input id="widFt" type="number" value="28" min="10" max="200">
      </div>
    </div>

    <div class="row">
      <div style="flex:1">
        <label>Vibe</label>
        <select id="vibe">
          <option value="auto">Auto</option>
          <option value="zen">Zen</option>
          <option value="family">Family</option>
          <option value="entertain">Entertaining</option>
          <option value="modern">Modern</option>
        </select>
      </div>

      <div style="flex:1">
        <label>Budget</label>
        <select id="budget">
          <option value="auto">Auto</option>
          <option value="low">Low</option>
          <option value="medium" selected>Medium</option>
          <option value="high">High</option>
        </select>
      </div>
    </div>

    <div style="margin:8px 0 4px 0;">
      <label>Features (auto or choose):</label>
    </div>

    <div class="row">
      <label class="check"><input id="f_pool" type="checkbox"> Pool</label>
      <label class="check"><input id="f_zen" type="checkbox"> Zen garden</label>
      <label class="check"><input id="f_deck" type="checkbox" checked> Deck</label>
     input id="f_perg" type="checkbox" checked> Pergola</label>
      <label class="check"><input id="f_path" type="checkbox" checked> Path</label>
      <label class="check"><input id="f_fire" type="checkbox"> Fire pit</label>
      <label class="check"><input id="f_beds" type="checkbox" checked> Planter beds</label>
    </div>

    <div class="row" style="margin-top:10px;">
      <button id="generate" class="btn primary">Generate Blueprint</button>
      <button id="closePanel" class="btn">Close</button>
    </div>

    <div class="small" style="margin-top:6px;">
      Tip: leave features unchecked to let the Orb decide.
    </div>
  </div>

  <!-- BLUEPRINT CANVAS -->
  <div id="blueprint" class="blueprint">
    <svg id="bpSvg" viewBox="0 0 1200 800" preserveAspectRatio="xMidYMid slice"></svg>
  </div>

  <!-- TOOLBAR -->
  <div id="toolbar" class="toolbar">
    <button id="regen" class="btn">üîÅ Regenerate</button>
    <button id="export" class="btn primary">‚¨áÔ∏è Export SVG</button>
  </div>

</div>
<script>
/* -------------------------------------------
   ELEMENT REFERENCES
--------------------------------------------*/
const orb = document.getElementById("orb");
const pupils = document.querySelectorAll(".pupil");
const greet = document.getElementById("greet");
const photo = document.getElementById("photo");
const panel = document.getElementById("panel");
const blueprint = document.getElementById("blueprint");
const svg = document.getElementById("bpSvg");
const toolbar = document.getElementById("toolbar");
const controls = document.getElementById("controls");

/* -------------------------------------------
   EYE TRACKING
--------------------------------------------*/
setTimeout(() => greet.classList.add("show"), 600);

document.addEventListener("mousemove", e => {
  document.querySelectorAll(".eye").forEach(eye => {
    const rect = eye.getBoundingClientRect();
    const cx = rect.left + rect.width / 2;
    const cy = rect.top + rect.height / 2;
    const angle = Math.atan2(e.clientY - cy, e.clientX - cx);
    const dx = Math.cos(angle) * 7;
    const dy = Math.sin(angle) * 7;
    eye.querySelector(".pupil").style.transform = `translate(${dx}px, ${dy}px)`;
  });
});

/* -------------------------------------------
   PHOTO UPLOAD
--------------------------------------------*/
document.getElementById("file").addEventListener("change", () => {
  const f = document.getElementById("file").files[0];
  if (!f) return;
  photo.src = URL.createObjectURL(f);
  greet.innerHTML = `Nice! I'll sketch ideas on a blueprint.<br><b>Click Generate Blueprint.</b>`;
});

/* -------------------------------------------
   UI BUTTONS
--------------------------------------------*/
document.getElementById("openPanel").onclick = () => panel.style.display = "block";
document.getElementById("closePanel").onclick = () => panel.style.display = "none";
document.getElementById("quick").onclick = () => generate();
document.getElementById("generate").onclick = () => generate();
document.getElementById("regen").onclick = () => generate(true);
document.getElementById("export").onclick = exportSVG;

/* -------------------------------------------
   GENERATION UTILITIES
--------------------------------------------*/
function clearSVG(){
  while (svg.firstChild) svg.removeChild(svg.firstChild);
}

function add(el){ svg.appendChild(el); return el; }

function elem(tag, attrs = {}, cls = ""){
  const e = document.createElementNS("http://www.w3.org/2000/svg", tag);
  for(const k in attrs) e.setAttribute(k, attrs[k]);
  if (cls) e.setAttribute("class", cls);
  return e;
}

function textAt(t, x, y){
  const tx = elem("text", { x, y, fill:"#67e8f9", "font-size":12 });
  tx.textContent = t;
  return tx;
}

function labelText(t, x, y){
  const tx = elem("text", { x, y, fill:"#67e8f9", "font-size":14 });
  tx.textContent = t;
  add(tx);
}

/* -------------------------------------------
   BLUEPRINT GENERATION
--------------------------------------------*/
function generate(isRegen = false){
  if (!isRegen){
    orb.classList.add("dock");
    greet.style.display = "none";
    controls.style.display = "none";
    panel.style.display = "none";
  }

  blueprint.style.display = "block";
  toolbar.style.display = "flex";
  clearSVG();

  const L = parseFloat(lenFt.value);
  const W = parseFloat(widFt.value);
  const vibe = vibeSelect.value;
  const budget = budgetSelect.value;

  const want = {
    pool: f_pool.checked,
    zen: f_zen.checked,
    deck: f_deck.checked,
    perg: f_perg.checked,
    path: f_path.checked,
    fire: f_fire.checked,
    beds: f_beds.checked
  };

  const area = L * W;
  const auto = Object.values(want).every(v => !v);

  if (auto){
    want.deck = true;
    want.path = true;
    want.beds = true;
    if(Math.random() < 0.5) want.perg = true;
    if(Math.random() < 0.45) want.pool = true;
    if(Math.random() < 0.4) want.zen = true;
    if(!want.pool && Math.random() < 0.25) want.fire = true;
  }

  drawBounds();

  let delay = 0;

  if (want.deck){
    drawDeck(460, 120, 280, 160, delay += 80);
    if (want.perg) drawPergola(480, 140, 240, 120, delay += 80);
  }

  if (want.pool) drawPool(240, 420, 150, 120, delay += 100);
  if (want.zen) drawZenGarden(860, 200, 260, 440, delay += 100);
  if (want.path) drawPath([{x:600,y:120},{x:600,y:300},{x:600,y:640}], delay += 60);
  if (want.fire) drawFirePit(600, 520, delay += 60);
  if (want.beds) drawBeds(delay += 60);

  labelText(`Estimated yard: ${Math.round(area)} sq ft  ‚Ä¢  Vibe: ${vibe}  ‚Ä¢  Budget: ${budget}`, 20, 780);
}

/* -------------------------------------------
   SHAPES
--------------------------------------------*/
function drawBounds(){
  const rect = add(elem("rect",{x:20,y:20,width:1160,height:760,fill:"none",stroke:"#67e8f9","stroke-width":2}));
  const house = add(elem("line",{x1:20,y1:110,x2:1180,y2:110,stroke:"#67e8f9","stroke-width":2,"stroke-dasharray":"8 8"}));
  labelText("House", 30, 102);
}

function drawDeck(x,y,w,h,d){
  const g = add(elem("g"));
  g.appendChild(elem("rect",{x,y,width:w,height:h,fill:"rgba(103,232,249,0.08)",stroke:"#67e8f9","stroke-width":2}));
  g.appendChild(textAt("DECK",x+w/2-16,y+h/2));
}

function drawPergola(x,y,w,h,d){
  const g = add(elem("g"));
  g.appendChild(elem("rect",{x,y,width:w,height:h,fill:"none",stroke:"#67e8f9","stroke-dasharray":"6 6","stroke-width":2}));
  g.appendChild(textAt("PERGOLA",x+w/2-30,y+h/2));
}

function drawPool(cx,cy,rx,ry,d){
  const g = add(elem("g"));
  g.appendChild(elem("ellipse",{cx,cy,rx,ry,fill:"rgba(103,232,249,0.13)",stroke:"#67e8f9","stroke-width":3}));
  g.appendChild(textAt("POOL",cx-18,cy));
}

function drawZenGarden(x,y,w,h,d){
  const g = add(elem("g"));
  g.appendChild(elem("rect",{x,y,width:w,height:h,rx:16,ry:16,fill:"rgba(103,232,249,0.07)",stroke:"#67e8f9","stroke-width":2}));
  g.appendChild(textAt("ZEN GARDEN",x+w/2-40,y+h/2));
}

function drawPath(points,d){
  const g = add(elem("g"));
  for(let i=1;i<points.length;i++){
    const b = points[i];
    g.appendChild(elem("rect",{x:b.x-16,y:b.y-10,width:32,height:20,rx:6,ry:6,fill:"rgba(103,232,249,0.08)",stroke:"#67e8f9"}));
  }
  g.appendChild(textAt("PATH",points[1].x-16,points[1].y+28));
}

function drawFirePit(cx,cy,delay){
  const g = add(elem("g"));
  g.appendChild(elem("circle",{cx,cy,r:36,fill:"none",stroke:"#67e8f9","stroke-width":2}));
  g.appendChild(textAt("FIRE",cx-14,cy+4));
}

function drawBeds(d){
  const g = add(elem("g"));
  g.appendChild(elem("rect",{x:26,y:140,width:30,height:560,fill:"rgba(103,232,249,0.08)",stroke:"#67e8f9","stroke-dasharray":"3 6"}));
  g.appendChild(elem("rect",{x:1144,y:140,width:30,height:560,fill:"rgba(103,232,249,0.08)",stroke:"#67e8f9","stroke-dasharray":"3 6"}));
  g.appendChild(textAt("PLANTERS",560,736));
}

/* -------------------------------------------
   EXPORT SVG
--------------------------------------------*/
function exportSVG(){
  const blob = new Blob([svg.outerHTML], {type:"image/svg+xml"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "backyard_blueprint.svg";
  a.click();
}

/* ============================================================
     3D CLICK + DRAG SYSTEM (Option A + B combined)
============================================================ */
let active3D = null;
let isDragging = false;
let dragStart = { x:0, y:0 };
let lastTransform = { x:0, y:0 };

svg.addEventListener("click", e => {
  const g = e.target.closest("g");
  if (!g) return;

  if (active3D){
    active3D.classList.remove("floating3D");
    active3D.style.transform = "";
  }

  active3D = g;
  g.classList.add("floating3D");

  /* Combined A + B effect */
  g.style.transform =
    "perspective(900px) rotateX(18deg) rotateY(6deg) scale(1.12)";

  const t = g.getAttribute("data-t") || "0,0";
  const [tx, ty] = t.split(",").map(Number);
  lastTransform = { x: tx, y: ty };
});

svg.addEventListener("mousedown", e => {
  if (!active3D) return;
  isDragging = true;

  const pt = svgPoint(e);
  dragStart.x = pt.x - lastTransform.x;
  dragStart.y = pt.y - lastTransform.y;
});

svg.addEventListener("mousemove", e => {
  if (!isDragging || !active3D) return;

  const pt = svgPoint(e);
  const x = pt.x - dragStart.x;
  const y = pt.y - dragStart.y;

  lastTransform = { x, y };
  active3D.setAttribute("transform", `translate(${x},${y})`);
  active3D.setAttribute("data-t", `${x},${y}`);
});

svg.addEventListener("mouseup", () => isDragging = false);
svg.addEventListener("mouseleave", () => isDragging = false);

function svgPoint(evt){
  const p = svg.createSVGPoint();
  p.x = evt.clientX;
  p.y = evt.clientY;
  return p.matrixTransform(svg.getScreenCTM().inverse());
}

</script>
</body>
</html>
