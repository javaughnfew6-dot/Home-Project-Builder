<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Blue Builder Helper ‚Äî Backyard Blueprint</title>
<style>
  :root{
    --bg:#081028;
    --grid:#0d2e5f;
   :100%}
  body{
    margin:0; font:16px/1.4 Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial;
    color:var(--text); background:var(--bg); overflow:hidden;
  }

  .app{position:relative; width:100%; height:100%}
  .photo-underlay{
    position:absolute; inset:0; object-fit:cover; opacity:.14;
    filter:saturate(0) contrast(1.1) brightness(.9);
 :50%;
    background:
      radial-gradient(65% 65% at 35% 30%, #ffffffaa, transparent 45%),
      radial-gradient(100% 100% at 50% 50%, var(--accent2), var(--accent));
    box-shadow:0 10px 40px #3b82f666, inset 0 0 120px #60a5fa44;
    display:flex; align-items:center; justify-content:center;
    animation:bounce 2s ease-in-out infinite;
    z-index:8;
  }
  .orb.dock{
    animation:none; transition:.9s ease;
    top:70px; left:50%; transform:translate(-50%,0);
    width:120px; height:120px;
  }
  @keyframes bounce{
    0%,100%{ transform:translate(-50%,-50%) }
    50%{ transform:translate(-50%,-60%) }
  }

  .eye{ width:38px; height:38px; background:#fff; border-radius:50%;
        position:absolute; overflow:hidden;}
  .eye .pupil{
    width:18px; height:18px; background:#000; border-radius:50%;
    position:absolute; top:10px; left:10px;
    transition: transform .05s linear;
  }
  .eyeL{ left:44px; top:56px }
  .eyeR{ right:44px; top:56px }
  .mouth{
    position:absolute; bottom:42px; left:50%;
    transform:translateX(-50%);
    width:56px; height:18px; background:#001a4d66;
    border-radius:0 0 40px 40px / 0 0 18px 18px;
    border:2px solid #001a4d99; border-top:none;
  }

  .greet{
    position:absolute; top:calc(58% + 130px); left:50%;
    transform:translateX(-50%);
    color:var(--text); text-align:center;
    font-size:24px; opacity:0;
    transition:opacity .8s;
    z-index:7;
  }
  .greet.show{ opacity:1 }

  .controls{
    position:absolute; left:50%; top:calc(58% + 200px);
    transform:translateX(-50%);
    display:flex; gap:12px; flex-wrap:wrap;
    justify-content:center; z-index:7;
  }

  .btn{
    appearance:none; cursor:pointer;
    border:1px solid #2a4ea0; color:#e5eeff;
    background:#0d1a3a; padding:10px 14px;
    border-radius:10px; font-weight:600;
  }
  .btn.primary{
    background:linear-gradient(180deg,#1d4ed8,#1e40af);
    border-color:#1e3a8a;
  }

  .blueprint{
    position:absolute; inset:0; z-index:4; display:none;
    background:
      linear-gradient(90deg,var(--grid2) 1px, transparent 1px) / 40px 40px repeat,
      linear-gradient(0deg,var(--grid2) 1px, transparent 1px) / 40px 40px repeat,
      linear-gradient(90deg,var(--grid) 1px, transparent 1px) / 200px 200px repeat,
      linear-gradient(0deg,var(--grid) 1px, transparent 1px) / 200px 200px repeat,
      linear-gradient(180deg,#071331,#091a3d);
  }
  svg{ width:100%; height:100% }

  .fall{
    opacity:0; transform:translateY(-180px);
    animation:fallIn .8s forwards;
  }
  @keyframes fallIn{
    to{ opacity:1; transform:translateY(0) }
  }

  .panel{
    position:absolute; right:14px; top:14px; z-index:9;
    width:360px; max-width:94vw;
    background:#0b1533cc; border:1px solid #1e2a4c;
    border-radius:12px; padding:12px; backdrop-filter:blur(6px);
    display:none;
  }

  label{ font-size:13px; color:var(--muted) }

  .toolbar{
    position:absolute; left:14px; top:14px;
    display:none; gap:8px; z-index:9;
  }

  /* ---- 3D FEATURE STYLE ---- */
  g.floating3D {
    transform-origin:center center;
    transition:transform .25s ease;
    cursor:grab;
    filter: drop-shadow(0px 10px 16px rgba(0,0,0,0.45));
  }
  g.floating3D:active { cursor:grabbing; }
</style>
</head>

<body>
<div class="app" id="app">
  <img id="photo" class="photo-underlay" alt="">

  <div id="orb" class="orb" aria-live="polite">
    <div class="eye eyeL"><div class="pupil"></div></div>
    <div class="eye eyeR"><div class="pupil"></div></div>
    <div class="mouth"></div>
  </div>

  <div id="greet" class="greet">Hi! I‚Äôm your builder helper.<br>Upload your backyard and I‚Äôll sketch a plan.</div>

  <div class="controls" id="controls">
    <label class="btn">
      <input id="file" type="file" accept="image/*" hidden>
      üîå Upload Backyard Photo
    </label>
    <button id="openPanel" class="btn">More Options</button>
    <button id="quick" class="btn primary">Generate Blueprint</button>
  </div>

  <div id="panel" class="panel">
    <h3>Backyard Settings</h3>
    <div class="row">
      <div style="flex:1">
        <label>Length (ft)</label>
        <input id="lenFt" type="number" min="10" max="200" value="40">
      </div>
      <div style="flex:1">
        <label>Width (ft)</label>
        <input id="widFt" type="number" min="10" max="200" value="28">
      </div>
    </div>

    <div class="row" style="margin-top:6px">
      <div style="flex:1">
        <label>Vibe</label>
        <select id="vibe">
          <option value="auto">Auto</option>
          <option value="zen">Zen</option>
          <option value="family">Family</option>
          <option value="entertain">Entertaining</option>
          <option value="modern">Modern</option>
        </select>
      </div>

      <div style="flex:1">
        <label>Budget</label>
        <select id="budget">
          <option value="auto">Auto</option>
          <option value="low">Low</option>
          <option value="medium" selected>Medium</option>
          <option value="high">High</option>
        </select>
      </div>
    </div>

    <div style="margin:8px 0 4px 0"><label>Features (auto or choose):</label></div>

   ="f_path" type="checkbox" checked> Path</label>
      <label class="check"><input id="f_fire" type="checkbox"> Fire pit</label>
      <label class="check"><input id="f_beds" type="checkbox" checked> Planter beds</label>
    </div>

    <div class="row" style="margin-top:10px">
      <button id="generate" class="btn primary">Generate Blueprint</button>
      <button id="closePanel" class="btn">Close</button>
    </div>

    <div class="small" style="margin-top:6px">Tip: leave features unchecked to let the Orb decide.</div>
  </div>

  <div id="blueprint" class="blueprint">
    <svg id="bpSvg" viewBox="0 0 1200 800" preserveAspectRatio="xMidYMid slice"></svg>
  </div>

  <div id="toolbar" class="toolbar">
    <button id="regen" class="btn">üîÅ Regenerate</button>
    <button id="export" class="btn primary">‚¨áÔ∏è Export SVG</button>
  </div>
</div>


<script>
/* ------------------------------ EYES ------------------------------ */
const orb = document.getElementById('orb');
const pupils = document.querySelectorAll('.pupil');
const greet = document.getElementById('greet');
const photo = document.getElementById('photo');
const panel = document.getElementById('panel');
const blueprint = document.getElementById('blueprint');
const svg = document.getElementById('bpSvg');
const toolbar = document.getElementById('toolbar');
const controls = document.getElementById('controls');

setTimeout(() => greet.classList.add('show'), 600);

document.addEventListener('mousemove', e => {
  document.querySelectorAll('.eye').forEach(eye => {
    const rect = eye.getBoundingClientRect();
    const cx = rect.left + rect.width/2;
    const cy = rect.top + rect.height/2;
    const angle = Math.atan2(e.clientY - cy, e.clientX - cx);
    const dx = Math.cos(angle)*7, dy = Math.sin(angle)*7;
    eye.querySelector('.pupil').style.transform = `translate(${dx}px, ${dy}px)`;
  });
});

/* ------------------------------ PHOTO ------------------------------ */
document.getElementById('file').addEventListener('change', () => {
  const f = file.files?.[0];
  if(!f) return;
  photo.src = URL.createObjectURL(f);
  greet.innerHTML = "Nice! I'll sketch ideas.<br><b>Generate Blueprint</b>.";
});

/* ------------------------------ UI ------------------------------ */
document.getElementById('openPanel').onclick = () => panel.style.display='block';
document.getElementById('closePanel').onclick = () => panel.style.display='none';
document.getElementById('quick').onclick = () => generate();
document.getElementById('generate').onclick = () => generate();
document.getElementById('regen').onclick = () => generate(true);
document.getElementById('export').onclick = exportSVG;

/* ------------------------------ GENERATION ------------------------------ */
const R = n => Math.random()*n;
const Ri = (a,b) => Math.floor(a+Math.random()*(b-a+1));

function clearSVG(){ while(svg.firstChild) svg.removeChild(svg.firstChild); }
function add(el){ svg.appendChild(el); return el; }
function elem(tag,attrs={},cls=''){
  const e = document.createElementNS("http://www.w3.org/2000/svg", tag);
  for(const k in attrs) e.setAttribute(k, attrs[k]);
  if(cls) e.setAttribute("class", cls);
  return e;
}
function fall(el,delay=0){
  el.style.opacity=0; el.style.transform='translateY(-180px)';
  el.style.transition='transform .6s ease, opacity .6s ease';
  setTimeout(() => { el.style.opacity=1; el.style.transform='translateY(0)' }, delay);
}

const stroke='#67e8f9';
const fillSoft='rgba(103,232,249,0.08)';
const hatch='rgba(103,232,249,0.18)';
const dot='rgba(103,232,249,0.9)';

function generate(isRegen=false){

  if(!isRegen){
    orb.classList.add("dock");
    greet.style.display="none";
    controls.style.display="none";
    panel.style.display="none";
  }

  blueprint.style.display="block";
  toolbar.style.display="flex";
  clearSVG();

  const L=parseFloat(lenFt.value||40);
  const W=parseFloat(widFt.value||28);
  const vibe=vibeSelect.value;
  const budget=budgetSelect.value;

  const want={
    pool:f_pool.checked,
    zen:f_zen.checked,
    deck:f_deck.checked,
    perg:f_perg.checked,
    path:f_path.checked,
    fire:f_fire.checked,
    beds:f_beds.checked
  };

  const area=L*W;
  const auto=Object.values(want).every(v=>!v);

  if(auto){
    want.deck=true; want.path=true; want.beds=true;
    if(Math.random()<0.5) want.perg=true;
    if(Math.random()<0.45) want.pool=true;
    if(Math.random()<0.4) want.zen=true;
    if(!want.pool && Math.random()<0.25) want.fire=true;
  }

  drawBounds();

  const zones=[
    {x:60,y:140,w:340,h:560},
    {x:430,y:140,w:340,h:560},
    {x:820,y:140,w:320,h:560},
  ];

  let delay=0;

  if(want.deck){
    drawDeck(460,120,280,160, delay+=80);
    if(want.perg) drawPergola(480,140,240,120, delay+=80);
  }

  if(want.pool) drawPool(240,420,150,120, delay+=100);
  if(want.zen)  drawZenGarden(860,200,260,440, delay+=100);
  if(want.path) drawPath([{x:600,y:120},{x:600,y:300},{x:600,y:640}], delay+=60);
  if(want.fire) drawFirePit(600,520,delay+=60);
  if(want.beds) drawBeds(delay+=60);

  labelText("Estimated yard: "+Math.round(area)+" sq ft", 20, 780);
}

function drawBounds(){
  const r=add(elem("rect",{x:20,y:20,width:1160,height:760,fill:"none",stroke:stroke,"stroke-width":2}));
  fall(r,40);

  const h=add(elem("line",{x1:20,y1:110,x2:1180,y2:110,stroke:stroke,"stroke-width":2,"stroke-dasharray":"8 8"}));
  fall(h,80);

  labelText("House", 30,102);
}

function labelText(t,x,y){
  const tx=elem("text",{x,y,fill:stroke,"font-size":14});
  tx.textContent=t;
  add(tx);
}

function textAt(t,x,y){
  const tx=elem("text",{x,y,fill:stroke,"font-size":12});
  tx.textContent=t;
  return tx;
}

function drawDeck(x,y,w,h,delay){
  const g=add(elem("g",{})); setTimeout(()=>g.classList.add("fall"),delay);
  g.appendChild(elem("rect",{x,y,width:w,height:h,fill:fillSoft,stroke:stroke,"stroke-width":2}));
  g.appendChild(textAt("DECK",x+w/2-16,y+h/2));
}

function drawPergola(x,y,w,h,delay){
  const g=add(elem("g",{})); setTimeout(()=>g.classList.add("fall"),delay);
  g.appendChild(elem("rect",{x,y,width:w,height:h,fill:"none",stroke:stroke,"stroke-width":2,"stroke-dasharray":"6 6"}));
  g.appendChild(textAt("PERGOLA",x+w/2-26,y+h/2));
}

function drawPool(cx,cy,rx,ry,delay){
  const g=add(elem("g",{})); setTimeout(()=>g.classList.add("fall"),delay);
  g.appendChild(elem("ellipse",{cx,cy,rx,ry,fill:"rgba(103,232,249,0.12)",stroke:stroke,"stroke-width":3}));
  g.appendChild(textAt("POOL",cx-18,cy));
}

function drawZenGarden(x,y,w,h,delay){
  const g=add(elem("g",{})); setTimeout(()=>g.classList.add("fall"),delay);
  g.appendChild(elem("rect",{x,y,width:w,height:h,fill:"rgba(103,232,249,0.07)",stroke:stroke,"stroke-width":2,rx:16,ry:16}));
  g.appendChild(textAt("ZEN GARDEN",x+w/2-40,y+h/2));
}

function drawPath(points,delay){
  const g=add(elem("g",{})); setTimeout(()=>g.classList.add("fall"),delay);
  for(let i=1; i<points.length; i++){
    const a=points[i-1], b=points[i];
    g.appendChild(elem("rect",{x:b.x-16,y:b.y-10,width:32,height:20,rx:6,ry:6,fill:fillSoft,stroke:stroke}));
  }
  g.appendChild(textAt("PATH", points[1].x-14, points[1].y+28));
}

function drawFirePit(cx,cy,delay){
  const g=add(elem("g",{})); setTimeout(()=>g.classList.add("fall"),delay);
  g.appendChild(elem("circle",{cx,cy,r:36,fill:"none",stroke:stroke,"stroke-width":2}));
  g.appendChild(textAt("FIRE",cx-14,cy+4));
}

function drawBeds(delay){
  const g=add(elem("g",{})); setTimeout(()=>g.classList.add("fall"),delay);
  g.appendChild(elem("rect",{x:26,y:140,width:30,height:560,fill:fillSoft,stroke:stroke,"stroke-dasharray":"3 6"}));
  g.appendChild(elem("rect",{x:1144,y:140,width:30,height:560,fill:fillSoft,stroke:stroke,"stroke-dasharray":"3 6"}));
  g.appendChild(textAt("PLANTERS",560,736));
}

/* ------------------------------ EXPORT ------------------------------ */
function exportSVG(){
  const blob=new Blob([svg.outerHTML],{type:"image/svg+xml"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="backyard_blueprint.svg";
  a.click();
}


/* ================================================================
     3D CLICK + DRAG SYSTEM ‚Äî FULL INTEGRATION
=================================================================*/

let active3D=null;
let isDragging=false;
let dragStart={x:0,y:0};
let lastTransform={x:0,y:0};

svg.addEventListener("click", e=>{
  const g=e.target.closest("g");
  if(!g) return;

  if(active3D){
    active3D.classList.remove("floating3D");
    active3D.style.transform="";
  }

  active3D=g;
  g.classList.add("floating3D");
  g.style.transform="perspective(900px) rotateX(18deg) scale(1.12)";

  const t=g.getAttribute("data-t")||"0,0";
  const [tx,ty]=t.split(",").map(Number);
  lastTransform={x:tx,y:ty};
});

svg.addEventListener("mousedown", e=>{
  if(!active3D) return;
  isDragging=true;

  const pt=svgPoint(e);
  dragStart.x=pt.x - lastTransform.x;
  dragStart.y=pt.y - lastTransform.y;
});

svg.addEventListener("mousemove", e=>{
  if(!isDragging || !active3D) return;

  const pt=svgPoint(e);
  const x=pt.x - dragStart.x;
  const y=pt.y - dragStart.y;

  lastTransform={x,y};
  active3D.setAttribute("transform",`translate(${x},${y})`);
  active3D.setAttribute("data-t",`${x},${y}`);
});

svg.addEventListener("mouseup",()=>isDragging=false);
svg.addEventListener("mouseleave",()=>isDragging=false);

function svgPoint(evt){
  const p=svg.createSVGPoint();
  p.x=evt.clientX;
  p.y=evt.clientY;
  return p.matrixTransform(svg.getScreenCTM().inverse());
}

</script>
</body>
</html>
